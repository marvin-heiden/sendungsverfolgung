kafka-topics.sh --create --zookeeper "zookeeper:2181" --replication-factor 1 --partitions 1 --topic input

kafka-topics.sh --zookeeper "zookeeper:2181" --alter --topic storage --partitions 10

kafka-console-consumer.sh --bootstrap-server "192.168.178.43:9092" --topic error

docker exec -it ksqldb-cli ksql http://ksqldb-server:8088

CREATE STREAM storage_stream (
    `Key`VARCHAR KEY,
    `Event` STRUCT<
        `EventTimestamp` VARCHAR,
        `EventType` VARCHAR,
        `ScanFacility` VARCHAR,
        `Message` VARCHAR,
        `Sender` STRUCT<Name VARCHAR, HouseNumber VARCHAR, City VARCHAR, PostCode VARCHAR, Country VARCHAR>,
        `Receiver` STRUCT<Name VARCHAR, HouseNumber VARCHAR, City VARCHAR, PostCode VARCHAR, Country VARCHAR>,
        `Identifiers` ARRAY<STRUCT<`Type` VARCHAR, `Value` VARCHAR>>
    >
) WITH (
    KAFKA_TOPIC='storage',
    VALUE_FORMAT='JSON'
);

SELECT
    `Event`->`EventTimestamp`,
    `Event`->`EventType`,
    `Event`->`ScanFacility`,
    `Event`->`Message`,
    `Event`->`Sender`,
    `Event`->`Identifiers`
FROM storage_stream
EMIT CHANGES;

SELECT
    `Key`,
    `Event`->`EventTimestamp`,
    `Event`->`EventType`,
    `Event`->`ScanFacility`,
    `Event`->`Message`,
    `Event`->`Sender`,
    `Event`->`Identifiers` as `IDENTIFIERS`
FROM storage_stream
WHERE `Key` = 'b501881732786721475b'
EMIT CHANGES;
